<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Us General Trading - Fully Responsive Inventory Dashboard</title>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* ==================== BASE STYLES ==================== */
        body { font-family: 'Open Sans', Arial, sans-serif; background-color: #f8f9fa; color: #343a40; margin: 0; padding: 0; line-height: 1.6; }
        .container { max-width: 1400px; margin: 40px auto; padding: 0; background-color: #ffffff; border-radius: 12px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1); overflow: hidden; }
        
        /* Header/Title Area */
        .header { background-color: #34495e; color: white; padding: 25px 30px; border-top-left-radius: 12px; border-top-right-radius: 12px; }
        .header h1 { font-size: 2rem; margin: 0; font-weight: 700; display: flex; align-items: center; }
        .header i { margin-right: 15px; font-size: 1.8em; color: #4fc3f7; }
        .content-area { padding: 30px; }

        /* ==================== BUTTONS & ACTIONS ==================== */
        .action-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; }
        .btn { 
            padding: 10px 18px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-weight: 600; 
            transition: all 0.2s ease-in-out; 
            display: inline-flex; 
            align-items: center; 
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.2); transform: translateY(-1px); }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-success:hover { background-color: #1e7e34; }
        .btn-secondary { background-color: #6c757d; color: white; }
        
        /* ==================== DATATABLES STYLING ==================== */
        /* Ensure DataTables search and entries display well on mobile */
        .dataTables_wrapper .dataTables_filter input { border: 1px solid #ced4da; padding: 8px 12px; border-radius: 5px; margin-left: 0.5em; width: 250px; transition: border-color 0.2s; }
        
        table.dataTable thead th { background-color: #007bff; color: white; border-color: #007bff; padding: 12px; font-weight: 600; }
        table.dataTable.hover tbody tr:hover { background-color: #e9ecef; cursor: pointer; }
        
        /* DataTables Responsive Control (+ icon) */
        table.dataTable.dtr-inline.collapsed>tbody>tr>td:first-child:before, table.dataTable.dtr-inline.collapsed>tbody>tr>th:first-child:before {
            background-color: #007bff; /* Blue plus icon */
        }
        
        /* ==================== CONDITIONAL ALERTS ==================== */
        .stock-level { font-weight: 700; padding: 3px 6px; border-radius: 4px; display: inline-block; }
        .low-stock { color: #dc3545; border: 1px solid #dc3545; background-color: #f8d7da; }
        .medium-stock { color: #ffc107; border: 1px solid #ffc107; background-color: #fff3cd; }
        .high-stock { color: #28a745; border: 1px solid #28a745; background-color: #d4edda; }

        /* ==================== DETAILS PANEL ==================== */
        #details-panel { 
            background-color: #ffffff; 
            border: 1px solid #e0e0e0; 
            border-left: 5px solid #007bff; 
            padding: 25px; 
            margin-top: 30px; 
            border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            display: none; 
        }
        #details-panel h2 { color: #343a40; margin-top: 0; font-size: 1.5rem; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        .detail-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px; }
        .detail-item strong { display: block; font-size: 0.85rem; color: #6c757d; margin-bottom: 3px; }

        /* Mobile adaptation for Details Panel */
        @media (max-width: 768px) {
            .container { margin: 20px 10px; padding: 0; }
            .header h1 { font-size: 1.6rem; }
            .content-area { padding: 15px; }
            .action-bar { justify-content: flex-end; }
            .action-bar p { display: none; /* Hide detailed info text on small screens */ }
            .detail-grid { grid-template-columns: 1fr; /* Stack details vertically on mobile */ }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-warehouse"></i> Trust Us General Trading - Inventory Dashboard</h1>
        </div>
        
        <div class="content-area">
            <div class="action-bar">
                <p style="font-size:1.1rem; color:#6c757d;">Search and manage warehouse items below. Click a row to view details.</p>
                <button class="btn btn-primary" id="show-add-modal">
                    <i class="fas fa-plus-circle"></i> Add New Item
                </button>
            </div>

            <table id="inventory-table" class="display responsive" style="width:100%">
                <thead>
                    <tr>
                        <th>Barcode</th>
                        <th>Product Name</th>
                        <th>Local Name</th>
                        <th>Unit</th>
                        <th>Department</th>
                        <th>Sub Department</th>
                        <th>In Stock</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>

            <div id="details-panel">
                <h2><i class="fas fa-info-circle"></i> Item Details: <span id="detail-product-name" style="color:#007bff;"></span></h2>
                <div class="detail-grid">
                    <div class="detail-item"><strong>Barcode:</strong> <span id="detail-barcode" class="detail-value"></span></div>
                    <div class="detail-item"><strong>Local Name:</strong> <span id="detail-local-name" class="detail-value"></span></div>
                    <div class="detail-item"><strong>Unit:</strong> <span id="detail-unit" class="detail-value"></span></div>
                    <div class="detail-item"><strong>Department:</strong> <span id="detail-department" class="detail-value"></span></div>
                    <div class="detail-item"><strong>Sub Department:</strong> <span id="detail-sub-department" class="detail-value"></span></div>
                    <div class="detail-item"><strong>Current Stock:</strong> <span id="detail-in-stock" class="detail-value"></span></div>
                </div>
                
                <hr style="margin-top: 25px; border-color: #f0f0f0;">
                <button class="btn btn-success" id="edit-button">
                    <i class="fas fa-edit"></i> Edit Item Data
                </button>
            </div>
        </div>
    </div>

    <div id="data-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <form id="data-form">
                <input type="hidden" id="item-barcode-original">

                <label for="barcode-input"><i class="fas fa-barcode"></i> Barcode (Unique ID):</label>
                <input type="text" id="barcode-input" name="Barcode" required>
                
                <label for="product-input"><i class="fas fa-box"></i> Product Name:</label>
                <input type="text" id="product-input" name="Product" required>

                <label for="local-name-input"><i class="fas fa-language"></i> Local Name:</label>
                <input type="text" id="local-name-input" name="Local Name">

                <label for="unit-input"><i class="fas fa-balance-scale"></i> Unit:</label>
                <input type="text" id="unit-input" name="Unit">

                <label for="department-input"><i class="fas fa-sitemap"></i> Department:</label>
                <input type="text" id="department-input" name="Department">

                <label for="sub-department-input"><i class="fas fa-list-alt"></i> Sub Department:</label>
                <input type="text" id="sub-department-input" name="Sub Department">

                <label for="in-stock-input"><i class="fas fa-sort-numeric-up-alt"></i> In Stock (Quantity):</label>
                <input type="number" id="in-stock-input" name="In Stock" required min="0">

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancel-button">Cancel</button>
                    <button type="submit" class="btn btn-success" id="save-button">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

    <script>
        // --- JAVASCRIPT LOGIC ---

        const STORAGE_KEY = 'warehouseInventoryData_v4_responsive'; 
        const LOW_STOCK_THRESHOLD = 50;
        const MEDIUM_STOCK_THRESHOLD = 150;
        
        const HEADERS = ["Barcode", "Product", "Local Name", "Unit", "Department", "Sub Department", "In Stock"];

        // Sample data 
        const initialData = [
            { "Barcode": "8936028610698", "Product": "AKITAKOMACHI VIETNAMESE RICE 5KG", "Local Name": "", "Unit": "Pcs", "Department": "RICE", "Sub Department": "Rice", "In Stock": 2728 },
            { "Barcode": "8809404601019", "Product": "Babyrang Plain Baby Wipes 100pcs", "Local Name": "베비랑 물티슈 리필 100매", "Unit": "Pcs", "Department": "Lifestyle", "Sub Department": "General", "In Stock": 20 },
            { "Barcode": "8809404600999", "Product": "Babyrang Plain Baby Wipes 80pcs", "Local Name": "베비랑 물티슈 캡형 80매", "Unit": "Pcs", "Department": "Lifestyle", "Sub Department": "General", "In Stock": 80 },
            { "Barcode": "8804387440087", "Product": "Bada Sushi Gim (Laver For Rice Roll) 220G", "Local Name": "바다향 김밥용김 (100매) 220G", "Unit": "Pcs", "Department": "Dry Items", "Sub Department": "Dried Vegetables", "In Stock": 96 },
            { "Barcode": "8801392011887", "Product": "BIBIGO PAN-FRIED MANDU 315G*2", "Local Name": "비비고 군만두 315G*2EA", "Unit": "Pcs", "Department": "Frozen Items", "Sub Department": "Frozen Food", "In Stock": 48 },
            { "Barcode": "8801007325248", "Product": "BIBIGO STEAMED DUMPLING 420G*2EA", "Local Name": "비비고 왕만두 420G*2EA", "Unit": "Pcs", "Department": "Frozen Items", "Sub Department": "Frozen Food", "In Stock": 4 },
            { "Barcode": "8809146750068", "Product": "YOUNGHWA BLACK BEAN SAUCE 10KG", "Local Name": "영화 검정양념장 10KG", "Unit": "Pcs", "Department": "Chilled Items", "Sub Department": "Sauce", "In Stock": 123 },
            { "Barcode": "0000000044035", "Product": "Xpera Speed300 Light Pink Golf Balls Pouch 9EA", "Local Name": "시합용 골프공", "Unit": "Pcs", "Department": "General", "Sub Department": "General", "In Stock": 30 }
        ];

        let inventoryData = [];
        let dataTable = null;

        function loadData() {
            const storedData = localStorage.getItem(STORAGE_KEY);
            if (storedData) {
                inventoryData = JSON.parse(storedData);
            } else {
                inventoryData = initialData;
                saveData();
            }
        }

        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(inventoryData));
            if (dataTable) {
                // To prevent DataTables from throwing an error if the responsive state is active,
                // we destroy and re-initialize it after updating the data source.
                dataTable.destroy();
                initializeDataTable(); 
            }
        }
        
        function getStockClass(quantity) {
            if (quantity < LOW_STOCK_THRESHOLD) return 'low-stock';
            if (quantity < MEDIUM_STOCK_THRESHOLD) return 'medium-stock';
            return 'high-stock';
        }

        function initializeDataTable() {
            const columnsConfig = HEADERS.map(header => ({ 
                title: header, 
                data: header,
                // Assign priority 1, 2, 3 to keep important columns visible first
                responsivePriority: (header === 'Product' ? 1 : header === 'In Stock' ? 2 : header === 'Barcode' ? 3 : 10), 
                render: function(data, type, row) {
                    if (header === 'In Stock' && type === 'display') {
                        const quantity = parseInt(data);
                        const className = getStockClass(quantity);
                        return `<span class="stock-level ${className}">${data}</span>`;
                    }
                    return data;
                }
            }));

            dataTable = $('#inventory-table').DataTable({
                data: inventoryData,
                columns: columnsConfig,
                paging: true,
                searching: true,
                info: true,
                order: [[6, 'asc']], // Order by In Stock quantity
                responsive: true // THIS IS THE KEY SETTING
            });
            // Re-bind the click listener after re-initialization
            setupRowClickListener();
        }

        function setupRowClickListener() {
            // Remove previous listener to avoid duplicates
            $('#inventory-table tbody').off('click', 'tr');

            $('#inventory-table tbody').on('click', 'tr', function () {
                const rowData = dataTable.row(this).data();
                if (!rowData) return;

                // Handle DataTables Responsive Row Detail Toggle
                if ($(this).hasClass('child') || $(this).hasClass('parent')) {
                    // Check if the click was specifically on the control column for details
                    if ($(event.target).closest('td').hasClass('dtr-control')) {
                         // Let DataTables handle the row expansion/collapse
                         return;
                    }
                }

                // If a normal row click, populate the Details Panel
                document.getElementById('detail-product-name').textContent = rowData['Product'];
                
                document.getElementById('detail-barcode').textContent = rowData['Barcode'];
                document.getElementById('detail-local-name').textContent = rowData['Local Name'] || 'N/A';
                document.getElementById('detail-unit').textContent = rowData['Unit'] || 'N/A';
                document.getElementById('detail-department').textContent = rowData['Department'] || 'N/A';
                document.getElementById('detail-sub-department').textContent = rowData['Sub Department'] || 'N/A';
                
                const stockElement = document.getElementById('detail-in-stock');
                const quantity = parseInt(rowData['In Stock']);
                stockElement.textContent = quantity;
                stockElement.className = `${getStockClass(quantity)} detail-value`;

                document.getElementById('edit-button').dataset.barcode = rowData['Barcode'];
                document.getElementById('details-panel').style.display = 'block';
            });
        }

        // --- MODAL & FORM LOGIC (Unchanged) ---
        const modal = document.getElementById('data-modal');
        const form = document.getElementById('data-form');

        document.getElementById('cancel-button').addEventListener('click', () => { modal.style.display = 'none'; });
        window.onclick = function(event) {
            if (event.target == modal) { modal.style.display = "none"; }
        }

        document.getElementById('edit-button').addEventListener('click', function() {
            const barcode = this.dataset.barcode;
            const item = inventoryData.find(d => d.Barcode === barcode);

            if (item) {
                document.getElementById('modal-title').textContent = `Edit Inventory Item: ${item.Product}`;
                document.getElementById('item-barcode-original').value = item.Barcode; 

                HEADERS.forEach(header => {
                    const inputId = header.toLowerCase().replace(/\s/g, '-') + '-input';
                    const input = document.getElementById(inputId);
                    if(input) input.value = item[header];
                });

                modal.style.display = 'block';
            }
        });

        document.getElementById('show-add-modal').addEventListener('click', function() {
            document.getElementById('modal-title').textContent = "Add New Inventory Item";
            form.reset();
            document.getElementById('item-barcode-original').value = ''; 
            modal.style.display = 'block';
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const originalBarcode = document.getElementById('item-barcode-original').value;
            const formData = new FormData(form);
            const newItem = {};
            
            HEADERS.forEach(header => {
                newItem[header] = formData.get(header) || "";
                if (header === 'In Stock') {
                    newItem[header] = parseInt(newItem[header] || 0);
                }
            });
            
            if (!newItem.Barcode) {
                alert('ERROR: Barcode cannot be empty.');
                return;
            }

            if (originalBarcode) {
                const index = inventoryData.findIndex(d => d.Barcode === originalBarcode);
                if (index !== -1) {
                    inventoryData[index] = newItem;
                }
                alert(`SUCCESS: Item ${newItem.Product} updated.`);
            } else {
                if (inventoryData.some(d => d.Barcode === newItem.Barcode)) {
                    alert('ERROR: Barcode already exists. Please use a unique barcode.');
                    return;
                }
                inventoryData.push(newItem);
                alert(`SUCCESS: New item ${newItem.Product} added.`);
            }

            saveData(); 
            document.getElementById('details-panel').style.display = 'none';
            modal.style.display = 'none';
        });

        // --- INITIAL EXECUTION ---
        $(document).ready(function() {
            loadData();
            initializeDataTable();
        });
    </script>
</body>
</html>